{"_id":"QFOJ0lKcE6Ppsfi4","name":"importStatblock","type":"script","author":"tCEwvo1Tq58EKcH1","img":"icons/svg/dice-target.svg","scope":"global","command":"const wait = async (ms) => new Promise((resolve)=> setTimeout(resolve, ms));\n\ntry {\n  if (event instanceof MessageEvent) {\n    ui.notifications.warn(\"It appears this is the first try importing a statblock since the world loaded. Please click the import button again\");\n  }\n  else {\n    var inputText = window.macroChain?.pop() || (typeof args == \"object\" ? args.join(\" \") : false) || event?.target.closest('button,a')?.textContent.trim();\n    \n    if (inputText) {\n      importBlock(inputText);\n    }\n    else {\n      ui.notifications.error('This macro can only be run from inside a Statblock Library journal entry');\n    }\n  }\n}\ncatch(err) {\n  ui.notifications.error('This macro can only be run from inside a Statblock Library journal entry');\n  console.log(err);\n}\n\nasync function importBlock(inputText) {\n  let sectionId = inputText.replace(/Import (.*) with SBC/gm, `$1`);\n  sectionId = sectionId.replace(/[^a-zA-Z0-9_]/gm, '');\n  \n  window.$('#startSBCButton')[0].click();\n  \n  let formInput = window.$(`#${sectionId}`)[0].innerText;\n  \n  await wait(250);\n  \n  window.$('#sbcInput')[0].value = formInput;\n  window.$('#sbcInput').keyup();\n}","folder":null,"sort":0,"permission":{"default":0,"tCEwvo1Tq58EKcH1":3},"flags":{"core":{"sourceId":"Macro.MaOQ2uyzPVE4jbDo"}}}
